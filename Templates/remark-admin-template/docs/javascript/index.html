<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5. Modular JavaScript - Remark Admin Template Docs</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "5. Modular JavaScript";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Remark Admin Template Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../index.html">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../overview/index.html">1. Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../build/index.html">2. Building Tools</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../global/index.html">3. Global Assets</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../style/index.html">4. Customize Styles</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="index.html">5. Modular JavaScript</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#5-modular-javascript">5. Modular JavaScript</a></li>
                
                    <li><a class="toctree-l4" href="#51-source-structure">5.1 Source Structure</a></li>
                
                    <li><a class="toctree-l4" href="#52-corejs">5.2 Core.js</a></li>
                
                    <li><a class="toctree-l4" href="#53-config-api">5.3 Config api</a></li>
                
                    <li><a class="toctree-l4" href="#54-component-registration">5.4 Component registration</a></li>
                
                    <li><a class="toctree-l4" href="#55-data-api">5.5 Data API</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../structure/index.html">6. Theme Structure</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../components/index.html">7. Components</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../psd/index.html">8. PSD Files</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../credits/index.html">9. Sources and Credits</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../support/index.html">10. Support</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../changelog/index.html">11. Changelog</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Remark Admin Template Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
    
    <li>5. Modular JavaScript</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/amazingSurge/remark-docs/" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="5-modular-javascript">5. Modular JavaScript</h1>
<h2 id="51-source-structure">5.1 Source Structure</h2>
<p>Remark template features a highly modular JavaScript source system. Each page can only uses the JavaScript it needs and nothing more.</p>
<p>The pre-complied files are under <code>(layout)/assets/js/</code> and <code>global/js</code> folder:</p>
<pre><code>(layout)/assets/js/
├── configs/
├── sections/ (site section script, such as: nav, sidebar...)
├── app.js (basic app site example)
└── site.js (site initialize function)

global/js/
├── components/ (bootstrap source files)
├── configs/ (js config file)
├── plugins/ (template plugins)
├── components.js (combine the files in components folder)
└── core.js (define root object $.site and $.components)
</code></pre>
<p>You can find their source files from <code>(layout)/src/js/</code> and <code>global/src/js</code> folder.</p>
<h2 id="52-corejs">5.2 Core.js</h2>
<p>In <code>global/js/core.js</code>, we provides three useful functionality: <strong>Site initialization</strong>, <strong>Config api</strong>, <strong>Component registration</strong>.</p>
<h3 id="site-initialization">Site initialization</h3>
<p>We provide a site initialization script which you can hook your script into the process easily by extend the <code>$.site</code>.</p>
<p>You will see we have a dequeue system. It provied dequeue functions for prepare, run and complete state.</p>
<pre><code class="javascript">/* line 10 */
$.extend($.site, {
  _queue: {
    prepare: [],
    run: [],
    complete: []
  },

  dequeue: function(name, done) {
    var self = this,
      queue = this.getQueue(name),
      fn = queue.shift(),
      next = function() {
        self.dequeue(name, done);
      };

    if (fn) {
      fn.call(this, next);
    } else if ($.isFunction(done)) {
      done.call(this);
    }
  },

  getQueue: function(name) {
    if (!$.isArray(this._queue[name])) {
      this._queue[name] = [];
    }

    return this._queue[name];
  }
};
</code></pre>

<p>The mainly run function is defined below in the file:</p>
<pre><code class="javascript">/* line 17 */
run: function() {
  var self = this;

  this.dequeue('prepare', function() {
    self.trigger('before.run', self);
  });

  this.dequeue('run', function() {
    self.dequeue('complete', function() {
      self.trigger('after.run', self);
    });
  });
}
</code></pre>

<p>And the <code>$.site.extend</code> method below:</p>
<pre><code class="javascript">/* line 54 */
extend: function(obj) {
  $.each(this._queue, function(name, queue) {
    if ($.isFunction(obj[name])) {
      queue.push(obj[name]);

      delete obj[name];
    }
  });

  $.extend(this, obj);

  return this;
}
</code></pre>

<p>We also provide <code>assets/js/site.js</code> file which set up all theme functionality e.g. menubar, gridmenu, sidebar, tooltip, page load animation and compoents. You can see the code snippet below:</p>
<pre><code class="javascript">/* line 18 */
window.Site = $.site.extend({
  run: function(next) {
    $('html').removeClass('before-run').addClass('after-run');

    // polyfill
    this.polyfillIEWidth();

    // Menubar setup
    // =============
    $.site.menu.init();

    $(&quot;.site-menubar&quot;).on('changing.site.menubar', function() {
      $('[data-toggle=&quot;menubar&quot;]').each(function() {
        var $this = $(this);
        var $hamburger = $(this).find('.hamburger');

        function toggle($el) {
          $el.toggleClass('hided', !$.site.menubar.opened);
          $el.toggleClass('unfolded', !$.site.menubar.folded);
        }
        if ($hamburger.length &gt; 0) {
          toggle($hamburger);
        } else {
          toggle($this);
        }
      });
    });

    // ...
  }
});
</code></pre>

<p>So, in your html, just add the <code>global/js/core.js</code> and the <code>assets/js/site.js</code> to the page, then write your scripts as follows:</p>
<pre><code class="html">&lt;script src=&quot;../global/js/core.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;assets/js/site.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
window.YouSite = Site.extend({
  run: function(next) {
    // your scripts here

    next();
  }
});

$(document).ready(function(){
  YouSite.run();
});
&lt;/script&gt;
</code></pre>

<p>It will excuted when document ready and all theme functionality will be initialized.</p>
<h2 id="53-config-api">5.3 Config api</h2>
<p>In <code>global/js/core.js</code>, we provide a simple config api:</p>
<pre><code class="javascript">/* line 121 */
// Configs
// =======
$.configs = $.configs || {};

$.extend($.configs, {
  data: {},
  get: function(name) {
    var callback = function(data, name) {
      return data[name];
    }

    var data = this.data;

    for (var i = 0; i &lt; arguments.length; i++) {
      name = arguments[i];

      data = callback(data, name);
    }

    return data;
  },

  set: function(name, value) {
    this.data[name] = value;
  },

  extend: function(name, options) {
    var value = this.get(name);
    return $.extend(true, value, options);
  }
});
</code></pre>

<p>You can share your config data on all your js files loaded in the page.</p>
<p>For example, you can setup your site configs in your <code>assets/js/configs.js</code>:</p>
<pre><code class="javascript">$.configs.set('site', {
  fontFamily: &quot;Noto Sans, sans-serif&quot;,
  primaryColor: &quot;blue&quot;
});
</code></pre>

<p>Then in your <code>assets/js/site.js</code></p>
<pre><code class="javascript">var color = $.configs.get('site', 'primaryColor');
console.info(color); // will output 'blue'
</code></pre>

<h2 id="54-component-registration">5.4 Component registration</h2>
<p>In <code>global/js/core.js</code> we also provide a simple component registration that will help your organize your 3rd component.</p>
<p>The full implementation code:</p>
<pre><code class="javascript">/* line 176 */
// Components
// ==========
$.components = $.components || {};

$.extend($.components, {
  _components: {},

  register: function(name, obj) {
    this._components[name] = obj;
  },

  init: function(name, context, args) {
    var self = this;

    if (typeof name === 'undefined') {
      $.each(this._components, function(name) {
        self.init(name);
      });
    } else {
      context = context || document;
      args = args || [];

      var obj = this.get(name);

      if (obj) {
        switch (obj.mode) {
          case 'default':
            return this._initDefault(name, context);
          case 'init':
            return this._initComponent(name, obj, context, args);
          case 'api':
            return this._initApi(name, obj, args);
          default:
            this._initApi(name, obj, context, args);
            this._initComponent(name, obj, context, args);
            return;
        }
      }
    }
  },

  /* init alternative, but only or init mode */
  call: function(name, context) {
    var args = Array.prototype.slice.call(arguments, 2);
    var obj = this.get(name);

    context = context || document;

    return this._initComponent(name, obj, context, args);
  },

  _initDefault: function(name, context) {
    if (!$.fn[name]) return;

    var defaults = this.getDefaults(name);

    $('[data-plugin=' + name + ']', context).each(function() {
      var $this = $(this),
        options = $.extend(true, {}, defaults, $this.data());

      $this[name](options);
    });
  },


  _initComponent: function(name, obj, context, args) {
    if ($.isFunction(obj.init)) {
      obj.init.apply(obj, [context].concat(args));
    }
  },

  _initApi: function(name, obj, args) {
    if (typeof obj.apiCalled === 'undefined' &amp;&amp; $.isFunction(obj.api)) {
      obj.api.apply(obj, args);

      obj.apiCalled = true;
    }
  },


  getDefaults: function(name) {
    var component = this.get(name);

    if (component &amp;&amp; typeof component.defaults !== &quot;undefined&quot;) {
      return component.defaults;
    } else {
      return {};
    }
  },

  get: function(name, property) {
    if (typeof this._components[name] !== &quot;undefined&quot;) {
      if (typeof property !== &quot;undefined&quot;) {
        return this._components[name][property];
      } else {
        return this._components[name];
      }
    } else {
      console.warn('component:' + component + ' script is not loaded.');

      return undefined;
    }
  }
});
</code></pre>

<h2 id="55-data-api">5.5 Data API</h2>
<p>Our component solution is very similar with <a href="http://getbootstrap.com/">Bootstrap</a> <strong>data-api</strong> syntax. It's a modualr way to organize the initialize script for the 3rd plugin.</p>
<h3 id="register">Register</h3>
<p>We use the function below to register component:</p>
<pre><code>$.components.register(name, obj);
</code></pre>
<p>We defined component register mode and initialize function in the object as second argument passed to the register method. There are three modes in the template:</p>
<ul>
<li><code>api</code>: will use <strong>api</strong> function defined in the obj and not need to be re-initialized when new elements added in <code>document</code>.</li>
<li><code>default</code>: will use <strong>default initialize function</strong> which is defined in <code>global/js/core.js</code>.</li>
<li><code>init</code>: will use <strong>init</strong> function and need to be re-initialized when new elements added in <code>document</code>.</li>
</ul>
<p>The raty  <code>obj</code> example:</p>
<pre><code>/*global/src/js/components/raty.js*/
$.components.register("rating", {
  mode: "init",
  defaults: {
    targetKeep: true,
    icon: "font",
    starType: "i",
    starOff: "icon wb-star",
    starOn: "icon wb-star orange-600",
    cancelOff: "icon wb-minus-circle",
    cancelOn: "icon wb-minus-circle orange-600",
    starHalf: "icon wb-star-half orange-500"
  },
  init: function(context) {
    if (!$.fn.raty) return;

    var defaults = $.components.getDefaults("rating");

    $('[data-plugin="rating"]', context).each(function() {
      var $this = $(this);
      var options = $.extend(true, {}, defaults, $this.data());

      if (options.hints) {
        options.hints = options.hints.split(',');
      }

      $this.raty(options);
    });
  }
});
</code></pre>
<h3 id="default-options-for-3rd-plugin">Default Options for 3rd plugin</h3>
<p>We define the <strong>default options</strong> for 3rd plugin by default property in each components' object. You can modify the <strong>default</strong> property to suit your use case.
When you manually initialize plugin, you can get the defaults options as follow:</p>
<pre><code>var defaults = $.components.getDefaults('{plugin name}');
</code></pre>
<h3 id="usage">Usage</h3>
<p>Just like <a href="http://getbootstrap.com/">Bootstrap</a> <code>data-api</code> usage, add <code>data-plugin="{plugin name}"</code> to element and add <code>[data-{options}]</code> to element. The components will be initialized.</p>
<p>For example:</p>
<pre><code class="html">// Load plugin necessary files
&lt;link rel=&quot;stylesheet&quot; href=&quot;assets/vendor/raty/jquery.raty.css&quot;&gt;
&lt;script src=&quot;assets/vendor/raty/jquery.raty.js&quot;&gt;&lt;/script&gt;
// Load Component register file
&lt;script src=&quot;assets/js/components/raty.js&quot;&gt;&lt;/script&gt;
// Component dom
&lt;div class=&quot;rating&quot; data-score=&quot;4&quot; data-plugin=&quot;rating&quot;&gt;&lt;/div&gt;
</code></pre>

<p>The rating component will be initialized after when page ready.</p>
<p>If we write script without our component solution, it will be</p>
<pre><code class="html">// Load plugin necessary files
&lt;link rel=&quot;stylesheet&quot; href=&quot;assets/vendor/raty/jquery.raty.css&quot;&gt;
&lt;script src=&quot;../global/vendor/raty/jquery.raty.js&quot;&gt;&lt;/script&gt;
// Component dom
&lt;div class=&quot;rating&quot; data-score=&quot;4&quot;&gt;&lt;/div&gt;

// Init Script
&lt;script&gt;
$(document).ready(function(){
  $('rating').each(function(){
    var $this = $(this);
    var score = $this.data('score');

    $this.raty({
      score: score,
      targetKeep: true,
      icon: &quot;font&quot;,
      starType: &quot;i&quot;,
      starOff: &quot;icon wb-star&quot;,
      starOn: &quot;icon wb-star orange-600&quot;,
      cancelOff: &quot;icon wb-minus-circle&quot;,
      cancelOn: &quot;icon wb-minus-circle orange-600&quot;,
      starHalf: &quot;icon wb-star-half orange-500&quot;
    });
  });
});
&lt;/script&gt;
</code></pre>

<p>The code is simple for one instance, but if you need use a lot rating instaces in different pages, and all rating instaces have different options or can not be initialized with the same code, that will be hard to maintenance.</p>
<h3 id="manually-call">Manually call</h3>
<p>You can also initialize the component manually:</p>
<pre><code>$.components.init('rating');
</code></pre>
<p>We can specific the context with the second argument for the component, it's very useful when we load the dom via ajax:</p>
<pre><code>$.components.init('rating', $('.page'));
</code></pre>
<h3 id="components-initialization">Components Initialization</h3>
<p>The components initialization script is implemented in <code>src/js/site.js'</code>.</p>
<pre><code class="html">window.Site = $.site.extend({
  run: function(next) {
    // code omitted
    // ...

    /* line 194 */
    // Init Loaded Components
    // ======================
    $.components.init();
  }
});
</code></pre>

<p>You can remove it if you don't need our components solution.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../structure/index.html" class="btn btn-neutral float-right" title="6. Theme Structure"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../style/index.html" class="btn btn-neutral" title="4. Customize Styles"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../style/index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../structure/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
